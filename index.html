<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Buy Zyma (ZYM)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.6.1/web3.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/accounting-js@0.4.1/accounting.min.js"></script> <!-- Added accounting.js for formatting -->
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to right, #3a7bd5, #00d2ff);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .wrapper {
      background: #fff;
      color: #333;
      width: 100%;
      max-width: 420px;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      text-align: center;
      position: relative;
    }

    h1 {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #2E8B57;
    }

    p {
      font-size: 16px;
      color: #555;
      margin-bottom: 30px;
    }

    .btn {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
      margin-top: 20px;
    }

    .btn-connect {
      background-color: #2E8B57;
      color: white;
    }

    .btn-connect:hover {
      background-color: #256f47;
      transform: translateY(-3px);
    }

    .btn-disconnect {
      background-color: #f44336;
      color: white;
      padding: 8px 16px;
      font-size: 14px;
      position: absolute;
      top: 20px;
      left: 20px;
      border-radius: 30px;
      z-index: 10;
      transition: background 0.3s ease, transform 0.3s ease;
    }

    .btn-disconnect:hover {
      background-color: #e31b2e;
      transform: translateY(-3px);
    }

    .input-field {
      padding: 12px;
      width: 80%;
      max-width: 280px;
      font-size: 16px;
      border: 2px solid #ccc;
      border-radius: 50px;
      margin: 15px 0;
      transition: border 0.3s ease;
    }

    .input-field:focus {
      border-color: #2E8B57;
      outline: none;
    }

    .info-text {
      margin-top: 10px;
      font-size: 14px;
      color: #888;
    }

    #buyBtn {
      background-color: #007BFF;
      color: white;
    }

    #buyBtn:hover {
      background-color: #0056b3;
      transform: translateY(-3px);
    }

    .percentage-btns {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    .percentage-btns button {
      background-color: #f2f2f2;
      color: #333;
      border-radius: 50px;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.3s ease, transform 0.3s ease;
    }

    .percentage-btns button:hover {
      background-color: #ddd;
      transform: translateY(-3px);
    }

    .status {
      margin-top: 20px;
      font-weight: 600;
      font-size: 16px;
    }

    .status.success { color: green; }
    .status.error { color: red; }
    .status.info { color: orange; }

    #balance {
      font-size: 14px;
      color: #888;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <button id="walletBtn" class="btn btn-connect"><i class="fa-solid fa-wallet"></i> Connect Wallet</button>
    <button id="disconnectBtn" class="btn btn-disconnect" style="display:none;"><i class="fa-solid fa-xmark"></i> Disconnect</button>

    <h1>Buy Zyma (ZYM)</h1>
    <p>Connect your wallet to buy Zyma (ZYM) tokens directly with USDT.</p>
    
    <div id="formSection" style="display:none;">
      <div id="balance"></div> <!-- Display user balance -->
      <input type="number" id="zymAmount" class="input-field" placeholder="Amount in ZYM" min="0" step="0.01" />
      <p id="usdtAmountText" class="info-text">You need to send <span id="usdtAmount">0</span> USDT to receive your ZYM tokens.</p>

      <div class="percentage-btns">
        <button id="btn10">10%</button>
        <button id="btn25">25%</button>
        <button id="btn50">50%</button>
        <button id="btn75">75%</button>
        <button id="btnMax">Max</button>
      </div>

      <button id="buyBtn" class="btn"><i class="fa-solid fa-shopping-cart"></i> Buy ZYM</button>
    </div>

    <div id="status" class="status"></div>
  </div>

  <script>
    const walletBtn = document.getElementById("walletBtn");
    const disconnectBtn = document.getElementById("disconnectBtn");
    const formSection = document.getElementById("formSection");
    const buyBtn = document.getElementById("buyBtn");
    const statusDiv = document.getElementById("status");
    const balanceDiv = document.getElementById("balance");

    let web3;
    let userAddress = null;
    let userUSDTBalance = 1000;  // Assume the user has 1000 USDT for demo purposes

    const ZYM_PRICE = 0.00019; // Price of 1 ZYM in USDT
    const USDT_CONTRACT = "0x55d398326f99059fF775485246999027B3197955"; // USDT on BSC
    const RECEIVER_ADDRESS = "0x6C157E7A6e8e2FDB9814b46326c71BCA19B3a92B"; // Your wallet
    const USDT_ABI = [
      {
        "constant": false,
        "inputs": [
          { "name": "_to", "type": "address" },
          { "name": "_value", "type": "uint256" }
        ],
        "name": "transfer",
        "outputs": [{ "name": "", "type": "bool" }],
        "type": "function"
      }
    ];

    // Format numbers with commas for easy reading
    function formatNumber(num) {
      return accounting.formatNumber(num, { thousand: "," });
    }

    async function connectWallet() {
      if (window.ethereum) {
        try {
          const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
          userAddress = accounts[0];
          web3 = new Web3(window.ethereum);
          walletBtn.textContent = "Disconnect Wallet";
          walletBtn.classList.remove("btn-connect");
          walletBtn.classList.add("btn-disconnect");
          formSection.style.display = "block";
          statusDiv.textContent = "Wallet connected: " + userAddress;
          statusDiv.className = "status success";
          disconnectBtn.style.display = "inline-block"; // Show Disconnect button
          balanceDiv.textContent = `Your USDT Balance: ${formatNumber(userUSDTBalance)} USDT`;
        } catch (err) {
          statusDiv.textContent = "Connection failed.";
          statusDiv.className = "status error";
        }
      } else {
        statusDiv.textContent = "Please install MetaMask.";
        statusDiv.className = "status error";
      }
    }

    function disconnectWallet() {
      userAddress = null;
      web3 = null;
      walletBtn.textContent = "Connect Wallet";
      walletBtn.classList.remove("btn-disconnect");
      walletBtn.classList.add("btn-connect");
      formSection.style.display = "none";
      disconnectBtn.style.display = "none";
      statusDiv.textContent = "";
      balanceDiv.textContent = "";
    }

    // Update USDT amount when ZYM amount is entered
    const zymAmountInput = document.getElementById("zymAmount");
    zymAmountInput.addEventListener("input", function() {
      const zymAmount = parseFloat(zymAmountInput.value);
      if (!isNaN(zymAmount) && zymAmount > 0) {
        const usdtAmount = zymAmount * ZYM_PRICE;
        document.getElementById("usdtAmount").textContent = formatNumber(usdtAmount);
      } else {
        document.getElementById("usdtAmount").textContent = "0";
      }
    });

    // Percentage buttons to autofill
    document.getElementById("btn10").addEventListener("click", () => setZymAmount(0.10));
    document.getElementById("btn25").addEventListener("click", () => setZymAmount(0.25));
    document.getElementById("btn50").addEventListener("click", () => setZymAmount(0.50));
    document.getElementById("btn75").addEventListener("click", () => setZymAmount(0.75));
    document.getElementById("btnMax").addEventListener("click", () => setZymAmount(1));

    function setZymAmount(percentage) {
      const zymAmount = userUSDTBalance * percentage / ZYM_PRICE;
      zymAmountInput.value = zymAmount.toFixed(2);
      const usdtAmount = zymAmount * ZYM_PRICE;
      document.getElementById("usdtAmount").textContent = formatNumber(usdtAmount);
    }

    // Buy ZYM (simulate transfer)
    buyBtn.addEventListener("click", async () => {
      const zymAmount = parseFloat(zymAmountInput.value);
      if (zymAmount > 0 && zymAmount <= userUSDTBalance / ZYM_PRICE) {
        try {
          statusDiv.textContent = "Buying " + formatNumber(zymAmount) + " ZYM...";
          statusDiv.className = "status info";

          // Here, we would interact with the blockchain to send the transaction
          // For demo purposes, we simulate a transfer
          const usdtAmount = zymAmount * ZYM_PRICE;
          setTimeout(() => {
            statusDiv.textContent = "Transaction successful! You received " + formatNumber(zymAmount) + " ZYM.";
            statusDiv.className = "status success";
            balanceDiv.textContent = `Your USDT Balance: ${formatNumber(userUSDTBalance - usdtAmount)} USDT`;
            zymAmountInput.value = ""; // Clear the input
          }, 2000);
        } catch (err) {
          statusDiv.textContent = "Transaction failed.";
          statusDiv.className = "status error";
        }
      } else {
        statusDiv.textContent = "Invalid amount entered.";
        statusDiv.className = "status error";
      }
    });

    walletBtn.addEventListener("click", connectWallet);
    disconnectBtn.addEventListener("click", disconnectWallet);
  </script>
</body>
</html>
